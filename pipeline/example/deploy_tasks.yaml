apiVersion: kan.k8s.io/v1beta1
kind: Task
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: deploy-with-helm
spec:
    inputs:
        sources:
            - name: workspace
        params:
            - name: pathToHelmCharts
              type: string
            - name: helmArgs
              type: string
            - name: image
              type: string
        cluster: 
            - name: clusterName
    buildSpec:
        steps:
        # TODO: just guessing how helm works
        - name: deploy
          image: kubernetes-helm
          args: ['deploy', '--path=', '${pathToHelmChart}', '--set image=${image}', '${helmArgs}']

---
apiVersion: kan.k8s.io/v1beta1
kind: Task
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: deploy-with-kubectl
spec:
    inputs:
        sources:
            - name: workspace
              type: string
        params:
            - name: kubectlArgs
              type: string
            - name: pathToFiles
              type: string
        cluster: 
            - name: targetCluster
    buildSpec:
        steps:
        - name: runKubectl
          image: k8s-kubectl
          args: ['--use-context', '${targetCluster}', '--namespace', '${targetCluster.namespace}', 'apply', '-c', '${pathToFiles}', '${kubectlArgs}']
